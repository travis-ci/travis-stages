Logic for evaluating stages based on a stage number.

This will probably go away. Keeping it separate for now to keep it very focussed,
and just in case we actually need this in Hub. Right now I assume we only need
it in Scheduler, so we might just copy it over to there.
